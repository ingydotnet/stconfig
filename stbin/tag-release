#!/bin/sh

BRANCH=$1
KIND=${2:-"release"}
if [ -z "$BRANCH" ]; then
    echo "Usage: $0 branch [tag_prefix=\"release\"] [message=\"\"]"
    exit 1
fi

TAG=`get-next-release-tag $KIND`
MESSAGE="Copying /code/branches/$BRANCH to /code/tags/$TAG. $3"

SVN_BASE=${ST_SVN:-"https://repo.socialtext.net:8999/svn"}
TAG_URL="$SVN_BASE/code/tags/$TAG"
if [ "$BRANCH" = "trunk" ]; then
    BRANCH_URL="$SVN_BASE/code/trunk"
else
    BRANCH_URL="$SVN_BASE/code/branches/$BRANCH"
fi

if svn -q copy -m "$MESSAGE" $BRANCH_URL $TAG_URL >/dev/null; then
    echo "Created tag $TAG from branch $BRANCH"
fi
