#!/bin/sh
set -e

BRANCH=$1
KIND=${2:-"release"}
MSG=$3
if [ -z "$BRANCH" ]; then
    echo "Usage: $0 branch [type] [message] [version]"
    exit 1
fi

VERSION=${4:-$(st-version $BRANCH)}
if [ -z "$VERSION" ]; then
    echo "Error: Could not determine version for $BRANCH";
    exit 1;
fi

TAG=`get-next-release-tag $KIND $VERSION`
MESSAGE="Copying /socialtext/branches/$BRANCH to /socialtext/tags/$TAG. $MSG"
BRANCH_URL=$(st-branch-url $BRANCH)
TAG_URL="$ST_CODE_REPO/tags/$TAG"

if svn -q copy -m "$MESSAGE" $BRANCH_URL $TAG_URL >/dev/null; then
    echo "Created tag $TAG from branch $BRANCH"
fi
